# 銷售數據處理器操作手冊

## 目錄
1. [專案概述](#專案概述)
2. [系統需求](#系統需求)
3. [安裝設定](#安裝設定)
4. [檔案結構](#檔案結構)
5. [使用方法](#使用方法)
6. [輸入檔案格式](#輸入檔案格式)
7. [輸出檔案說明](#輸出檔案說明)
8. [常見問題](#常見問題)
9. [錯誤處理](#錯誤處理)
10. [注意事項](#注意事項)

## 專案概述

銷售數據處理器是一個 Python 程式，專門用於處理銷售試算表數據，並生成統計報表。該程式能夠：

- 批量處理 Excel 試算表檔案（支援 .xls、.xlsx、.xlsm 格式）
- 自動提取商品銷售資訊
- 根據付款方式進行分類統計
- 產生格式化的銷售統計報表
- 處理掛帳客戶資訊
- 自動計算稅額和未稅金額

## 系統需求

### Python 版本
- Python 3.7 或更新版本

### 必要套件
所有相依套件已列在 `requirements.txt` 檔案中：
```
pandas>=1.3.0
numpy>=1.21.0
openpyxl>=3.0.0
xlrd>=2.0.0
lxml>=4.6.0
html5lib>=1.1
```

## 安裝設定

### 1. 安裝 Python 環境
確保您的系統已安裝 Python 3.7 或更新版本。

### 2. 安裝相依套件
在專案目錄中執行：
```bash
pip install -r requirements.txt
```

### 3. 準備必要檔案
確保以下檔案存在於專案目錄中：
- `產品代號表.xlsx` - 產品代號對照表
- `掛帳客戶供應商對照表(包含傳票類別).xlsx` - 掛帳客戶資訊
- `客戶供應商代號和傳票類別.xlsx` - 客戶代號對照表

## 檔案結構

```
專案目錄/
├── sales_data_processor.py      # 主程式
├── requirements.txt             # Python 套件需求
├── 產品代號表.xlsx              # 產品代號對照表
├── 掛帳客戶供應商對照表(包含傳票類別).xlsx
├── 客戶供應商代號和傳票類別.xlsx
├── 0722-0728/                   # 銷售資料資料夾（範例）
│   ├── 58790723001.xls
│   ├── 58800723002.xls
│   └── ... (其他銷售試算表檔案)
└── 統計資料/                    # 統計結果輸出資料夾
    ├── 0601-0607.xlsx
    ├── 0608-0614.xlsx
    └── ... (統計結果檔案)
```

## 使用方法

### 1. 執行程式
在命令提示字元或終端機中，切換到專案目錄後執行：
```bash
python sales_data_processor.py
```

### 2. 設定檔案路徑
程式執行後會依序要求您輸入以下路徑：

1. **銷售資料資料夾路徑**
   - 輸入包含所有銷售試算表檔案的資料夾路徑
   - 範例：`C:\專案目錄\0722-0728`

2. **統計資料輸出檔案路徑**
   - 輸入統計結果要儲存的檔案路徑
   - 範例：`統計資料\0722-0728.xlsx`

3. **掛帳查詢檔案路徑**
   - 輸入掛帳客戶對照表檔案路徑
   - 範例：`掛帳客戶供應商對照表(包含傳票類別).xlsx`

4. **客戶代號檔案路徑**
   - 輸入客戶供應商代號對照表檔案路徑
   - 範例：`客戶供應商代號和傳票類別.xlsx`

5. **產品代號檔案路徑**
   - 輸入產品代號對照表檔案路徑
   - 範例：`產品代號表.xlsx`

### 3. 程式執行流程
1. 載入產品代號對照表
2. 載入掛帳客戶對照表
3. 掃描並列出所有 Excel 檔案
4. 逐一處理每個銷售試算表
5. 生成統計資料並寫入 Excel 檔案

## 輸入檔案格式

### 銷售試算表檔案
每個銷售試算表應包含以下欄位：
- **品　種** - 商品名稱或付款方式
- **時間** - 交易時間
- **單價** - 商品單價
- **類別** - 商品類別（掛帳時用於客戶代號）
- **數量** - 商品數量
- **金額** - 交易金額
- **發票** - 發票資訊
- **贈送原因** - 公關品標記

### 產品代號對照表
- **B 欄** - 產品代號
- **C 欄** - 產品名稱

### 掛帳客戶對照表
- **B 欄** - 客戶帳號
- **J 欄** - 傳票類別

## 輸出檔案說明

### 統計資料工作表
包含以下欄位：
- **B 欄** - 銷貨單號（檔案名稱，去除副檔名）
- **C 欄** - 客供商代號
- **E 欄** - 產品代號
- **F 欄** - 數量（整數）
- **G 欄** - 銷貨日期
- **S 欄** - 稅別
- **V 欄** - 含稅總金額
- **W 欄** - 總稅額
- **Z 欄** - 傳票類別
- **AA 欄** - 未稅單價
- **AB 欄** - 未稅金額
- **AC 欄** - 稅額
- **AK 欄** - 發票號碼
- **AW 欄** - 備註

### 特殊客供商記錄工作表
記錄使用特殊客戶代號（52、53、54、55）的交易：
- **日期** - 交易日期
- **客供商代號** - 特殊代號
- **銷貨單號** - 對應的試算表檔名

## 常見問題

### Q1: 程式執行時出現「找不到檔案」錯誤
**A:** 請確認：
- 檔案路徑是否正確
- 檔案是否存在
- 檔案名稱是否正確（包括副檔名）

### Q2: Excel 檔案讀取失敗
**A:** 可能原因：
- 檔案格式不支援（請確保是 .xls、.xlsx 或 .xlsm 格式）
- 檔案損毀
- 檔案正在其他程式中開啟

### Q3: 輸出檔案無法寫入
**A:** 請檢查：
- 目標資料夾是否存在
- 是否有寫入權限
- 輸出檔案是否正在 Excel 中開啟

### Q4: 產品代號顯示「未查到此商品」
**A:** 請確認：
- 產品代號對照表是否正確載入
- 商品名稱是否與對照表中的名稱完全一致
- 注意空格和標點符號的差異

## 錯誤處理

### 權限錯誤
```
❌ 權限錯誤：無法寫入檔案
```
**解決方法：**
1. 關閉所有開啟該檔案的程式
2. 確認有寫入資料夾的權限
3. 嘗試使用不同的檔案名稱

### 檔案路徑錯誤
```
❌ 檔案路徑錯誤：找不到目標資料夾
```
**解決方法：**
1. 確認路徑輸入正確
2. 使用絕對路徑
3. 確認資料夾存在

### 欄位缺失錯誤
```
[檔案名稱] 缺少 '品種' 或 '時間' 欄位
```
**解決方法：**
1. 檢查試算表格式
2. 確認必要欄位存在
3. 檢查欄位名稱是否正確

## 注意事項

### 1. 檔案格式
- 支援 Excel 格式：.xls、.xlsx、.xlsm
- 也支援 HTML 格式的表格檔案

### 2. 付款方式識別
程式會自動識別以下付款方式：
- **現金** - 包含「現金」字樣
- **信用卡** - 包含 VISA、MASTER、AE、JCB、銀聯
- **掛帳** - 包含「挂帳」字樣
- **匯款** - 包含「匯款」或「訂金」字樣
- **多種** - 同時包含多種付款方式

### 3. 特殊處理項目
- **公關品** - 贈送原因標記為「公關品」的項目會使用客戶代號 000995
- **服務費** - 商品名稱為「[服務費]」的項目有特殊處理邏輯
- **特殊客戶代號** - 52、53、54、55 不會補滿六位數

### 4. 日期格式
- 程式會從檔名自動提取日期（格式：YYYYMMDD）
- 輸出格式為民國年/月/日（例：114/07/22）

### 5. 金額計算
- 自動計算未稅金額和稅額
- 稅率固定為 5%（1.05）
- 金額會四捨五入至整數

### 6. 備份建議
- 處理前請備份原始檔案
- 建議先用少量檔案測試
- 確認輸出結果正確後再處理全部檔案

---

如有任何問題或建議，請檢查程式執行訊息或聯繫系統管理員。